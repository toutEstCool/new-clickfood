# Features Layer (–°–ª–æ–π —Ñ–∏—á)

## üìã –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–°–ª–æ–π **features** —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è - –¥–µ–π—Å—Ç–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ—Å—É—Ç —Ü–µ–Ω–Ω–æ—Å—Ç—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É
- –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è
- –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫
- –ü–æ—Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫
- –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤

> **–ì–ª–∞–≤–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø:** –û–¥–Ω–∞ —Ñ–∏—á–∞ = –æ–¥–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∏—á–∏

```
features/
‚îú‚îÄ‚îÄ add-to-cart/              # –§–∏—á–∞: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É
‚îÇ   ‚îú‚îÄ‚îÄ model/               # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useAddToCart.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ ui/                  # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AddToCartButton.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AddToCartButton.module.css
‚îÇ   ‚îú‚îÄ‚îÄ api/                 # API –∑–∞–ø—Ä–æ—Å—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ addToCartApi.ts
‚îÇ   ‚îî‚îÄ‚îÄ index.ts             # Public API
‚îú‚îÄ‚îÄ auth/                    # –§–∏—á–∞: –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ search/                  # –§–∏—á–∞: –ø–æ–∏—Å–∫
‚îî‚îÄ‚îÄ README.md
```

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø—ã

1. **–û–¥–Ω–∞ —Ñ–∏—á–∞ = –æ–¥–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ** - –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É, –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è, etc.
2. **–ë–∏–∑–Ω–µ—Å-—Ü–µ–Ω–Ω–æ—Å—Ç—å** - —Ñ–∏—á–∞ –¥–æ–ª–∂–Ω–∞ –Ω–µ—Å—Ç–∏ –ø–æ–ª—å–∑—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å** - —Ñ–∏—á–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –¥—Ä—É–≥–∏—Ö —Ñ–∏—á
4. **Public API** - –Ω–∞—Ä—É–∂—É —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É (Add to Cart)

```tsx
// features/add-to-cart/model/useAddToCart.ts
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { addToCartApi } from '../api/addToCartApi';
import { showNotification } from '@/shared/lib/notifications';

export const useAddToCart = () => {
  const queryClient = useQueryClient();

  const mutation = useMutation({
    mutationFn: (productId: string) => addToCartApi(productId),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['cart'] });
      showNotification({
        type: 'success',
        message: '–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É',
      });
    },
    onError: () => {
      showNotification({
        type: 'error',
        message: '–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä',
      });
    },
  });

  return {
    addToCart: mutation.mutate,
    isLoading: mutation.isPending,
  };
};
```

```tsx
// features/add-to-cart/ui/AddToCartButton.tsx
import { useAddToCart } from '../model/useAddToCart';
import { Button } from '@/shared/ui/button';
import { ShoppingCartIcon } from '@/shared/ui/icons';
import styles from './AddToCartButton.module.css';

interface AddToCartButtonProps {
  productId: string;
  className?: string;
}

export const AddToCartButton = ({ 
  productId, 
  className 
}: AddToCartButtonProps) => {
  const { addToCart, isLoading } = useAddToCart();

  return (
    <Button
      className={className}
      onClick={() => addToCart(productId)}
      loading={isLoading}
      icon={<ShoppingCartIcon />}
    >
      –í –∫–æ—Ä–∑–∏–Ω—É
    </Button>
  );
};
```

```ts
// features/add-to-cart/api/addToCartApi.ts
import { api } from '@/shared/api';

export const addToCartApi = async (productId: string) => {
  const response = await api.post('/cart/items', { productId });
  return response.data;
};
```

```ts
// features/add-to-cart/index.ts
export { AddToCartButton } from './ui/AddToCartButton';
export { useAddToCart } from './model/useAddToCart';
```

### –ü—Ä–∏–º–µ—Ä 2: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞

```tsx
// features/auth/model/useAuth.ts
import { useState } from 'react';
import { useMutation } from '@tanstack/react-query';
import { sendCodeApi, verifyCodeApi } from '../api/authApi';

type AuthStep = 'phone' | 'code' | 'success';

export const useAuth = () => {
  const [step, setStep] = useState<AuthStep>('phone');
  const [phone, setPhone] = useState('');

  const sendCode = useMutation({
    mutationFn: (phoneNumber: string) => sendCodeApi(phoneNumber),
    onSuccess: () => {
      setStep('code');
    },
  });

  const verifyCode = useMutation({
    mutationFn: (code: string) => verifyCodeApi(phone, code),
    onSuccess: () => {
      setStep('success');
    },
  });

  return {
    step,
    phone,
    setPhone,
    sendCode: sendCode.mutate,
    verifyCode: verifyCode.mutate,
    isLoading: sendCode.isPending || verifyCode.isPending,
  };
};
```

```tsx
// features/auth/ui/AuthModal.tsx
import { useAuth } from '../model/useAuth';
import { Modal } from '@/shared/ui/modal';
import { PhoneInput } from '@/shared/ui/phone-input';
import { CodeInput } from '@/shared/ui/code-input';
import { Button } from '@/shared/ui/button';
import styles from './AuthModal.module.css';

interface AuthModalProps {
  isOpen: boolean;
  onClose: () => void;
}

export const AuthModal = ({ isOpen, onClose }: AuthModalProps) => {
  const { 
    step, 
    phone, 
    setPhone, 
    sendCode, 
    verifyCode, 
    isLoading 
  } = useAuth();

  return (
    <Modal isOpen={isOpen} onClose={onClose}>
      <div className={styles.modal}>
        <h2>–í—Ö–æ–¥</h2>
        
        {step === 'phone' && (
          <>
            <PhoneInput 
              value={phone} 
              onChange={setPhone} 
            />
            <Button 
              onClick={() => sendCode(phone)}
              loading={isLoading}
              fullWidth
            >
              –ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥
            </Button>
          </>
        )}
        
        {step === 'code' && (
          <>
            <p>–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ SMS</p>
            <CodeInput 
              length={4}
              onComplete={verifyCode}
            />
          </>
        )}
        
        {step === 'success' && (
          <p>–í—ã —É—Å–ø–µ—à–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã!</p>
        )}
      </div>
    </Modal>
  );
};
```

### –ü—Ä–∏–º–µ—Ä 3: –ü–æ–∏—Å–∫ —Å –¥–µ–±–∞—É–Ω—Å–æ–º

```tsx
// features/search/model/useSearch.ts
import { useState, useEffect } from 'react';
import { useQuery } from '@tanstack/react-query';
import { searchProductsApi } from '../api/searchApi';
import { useDebounce } from '@/shared/lib/hooks';

export const useSearch = () => {
  const [query, setQuery] = useState('');
  const debouncedQuery = useDebounce(query, 500);

  const { data: results, isLoading } = useQuery({
    queryKey: ['search', debouncedQuery],
    queryFn: () => searchProductsApi(debouncedQuery),
    enabled: debouncedQuery.length > 2,
  });

  return {
    query,
    setQuery,
    results: results || [],
    isLoading,
  };
};
```

```tsx
// features/search/ui/SearchBar.tsx
import { useSearch } from '../model/useSearch';
import { Input } from '@/shared/ui/input';
import { SearchIcon } from '@/shared/ui/icons';
import { SearchResults } from './SearchResults';
import styles from './SearchBar.module.css';

export const SearchBar = () => {
  const { query, setQuery, results, isLoading } = useSearch();

  return (
    <div className={styles.search}>
      <Input
        value={query}
        onChange={(e) => setQuery(e.target.value)}
        placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..."
        icon={<SearchIcon />}
      />
      
      {query && (
        <SearchResults 
          results={results}
          isLoading={isLoading}
        />
      )}
    </div>
  );
};
```

### –ü—Ä–∏–º–µ—Ä 4: Toggle —Ñ–∏—á–∞ (–ò–∑–±—Ä–∞–Ω–Ω–æ–µ)

```tsx
// features/toggle-favorite/model/useFavorite.ts
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { toggleFavoriteApi } from '../api/favoriteApi';
import { useFavorites } from '@/entities/favorite';

export const useFavorite = (productId: string) => {
  const queryClient = useQueryClient();
  const { favorites } = useFavorites();
  
  const isFavorite = favorites.includes(productId);

  const mutation = useMutation({
    mutationFn: () => toggleFavoriteApi(productId),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['favorites'] });
    },
  });

  return {
    isFavorite,
    toggle: mutation.mutate,
    isLoading: mutation.isPending,
  };
};
```

```tsx
// features/toggle-favorite/ui/FavoriteButton.tsx
import { useFavorite } from '../model/useFavorite';
import { IconButton } from '@/shared/ui/icon-button';
import { HeartIcon } from '@/shared/ui/icons';
import styles from './FavoriteButton.module.css';

interface FavoriteButtonProps {
  productId: string;
  className?: string;
}

export const FavoriteButton = ({ 
  productId, 
  className 
}: FavoriteButtonProps) => {
  const { isFavorite, toggle, isLoading } = useFavorite(productId);

  return (
    <IconButton
      className={className}
      onClick={toggle}
      disabled={isLoading}
      aria-label={isFavorite ? '–£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ' : '–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ'}
    >
      <HeartIcon 
        filled={isFavorite}
        className={isFavorite ? styles.active : ''}
      />
    </IconButton>
  );
};
```

### –ü—Ä–∏–º–µ—Ä 5: –§–æ—Ä–º–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

```tsx
// features/leave-review/model/useReviewForm.ts
import { useState } from 'react';
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { submitReviewApi } from '../api/reviewApi';
import { validateReview } from '../lib/validation';

interface ReviewFormData {
  rating: number;
  text: string;
  author: string;
}

export const useReviewForm = (productId: string) => {
  const queryClient = useQueryClient();
  const [formData, setFormData] = useState<ReviewFormData>({
    rating: 0,
    text: '',
    author: '',
  });
  const [errors, setErrors] = useState<Record<string, string>>({});

  const mutation = useMutation({
    mutationFn: () => submitReviewApi(productId, formData),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['reviews', productId] });
      setFormData({ rating: 0, text: '', author: '' });
    },
  });

  const handleSubmit = () => {
    const validationErrors = validateReview(formData);
    
    if (Object.keys(validationErrors).length > 0) {
      setErrors(validationErrors);
      return;
    }
    
    mutation.mutate();
  };

  return {
    formData,
    setFormData,
    errors,
    handleSubmit,
    isLoading: mutation.isPending,
  };
};
```

## ü§î –§–∏—á–∞ –∏–ª–∏ –Ω–µ —Ñ–∏—á–∞?

### ‚úÖ –≠—Ç–æ —Ñ–∏—á–∞:

- ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É** - –¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ **–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π
- ‚úÖ **–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã** - –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
- ‚úÖ **–ü–æ—Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫** - –¥–µ–π—Å—Ç–≤–∏–µ
- ‚úÖ **–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤** - —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### ‚ùå –≠—Ç–æ –ù–ï —Ñ–∏—á–∞:

- ‚ùå **–ö–Ω–æ–ø–∫–∞** - —ç—Ç–æ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ‚Üí `shared/ui`
- ‚ùå **–¢–æ–≤–∞—Ä** - —ç—Ç–æ —Å—É—â–Ω–æ—Å—Ç—å ‚Üí `entities/product`
- ‚ùå **–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤** - —ç—Ç–æ –≤–∏–¥–∂–µ—Ç ‚Üí `widgets`
- ‚ùå **API –∫–ª–∏–µ–Ω—Ç** - —ç—Ç–æ —É—Ç–∏–ª–∏—Ç–∞ ‚Üí `shared/api`

## ‚ö†Ô∏è –ß—Ç–æ –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ features

- ‚ùå –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥—Ä—É–≥–∏—Ö —Ñ–∏—á
- ‚ùå –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –≥–ª–æ–±–∞–ª—å–Ω–æ–º—É —Å—Ç–µ–π—Ç—É (—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ entities)
- ‚ùå –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

## ‚úÖ –ß—Ç–æ –î–û–õ–ñ–ù–û –±—ã—Ç—å –≤ features

- ‚úÖ –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
- ‚úÖ UI –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## üîÑ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ —Å–ª–æ—è–º–∏

```
features
   ‚Üì –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç
entities + shared
   ‚Üë –ù–ï –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç
pages, widgets, –¥—Ä—É–≥–∏–µ features
```

## üìù Naming Convention

- –ü–∞–ø–∫–∞: –≥–ª–∞–≥–æ–ª –≤ –∏–Ω—Ñ–∏–Ω–∏—Ç–∏–≤–µ `add-to-cart`, `toggle-favorite`
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç: —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ `AddToCartButton`, `FavoriteButton`
- –•—É–∫: `use` + –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏—á–∏ `useAddToCart`, `useFavorite`
